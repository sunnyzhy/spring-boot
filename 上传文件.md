# 上传文件

## 以 form-data 的形式上传

1. 把文件作为表单数据的一部分上传，表单的数据之间以标签为单元，用 ```boundary``` 分隔符分开
2. ```Content-Type: multipart/form-data```
3. 把文件存储到本地：
    ```java
    @PostMapping
    public String upload(@RequestPart("file") MultipartFile file) {
        String filePath = "/a/b/c.log";
        File realFile = new File(filePath);
        realFile.getParentFile().mkdirs();
        file.transferTo(realFile);
    }
    ```

## 以 binary 的形式上传

1. 把文件作为二进制数据上传
2. ```Content-Type: application/octet-stream```
3. 把文件存储到本地：
    ```java
    @PutMapping
    public String upload(HttpServletRequest request) {
        String filePath = "/a/b/c.log";
        File realFile = new File(filePath);
        realFile.getParentFile().mkdirs();
        Path path = Paths.get(filePath);
        FileCopyUtils.copy(request.getInputStream(), Files.newOutputStream(path));
    }
    ```

## FAQ

### 413 Request Entity Too Large

1. Nginx服务器配置
    在 **http{ }** 中配置：client_max_body_size 100M
    ```bas
    # vim ./conf/nginx.conf
    client_max_body_size 100M;
    
    # ./sbin/nginx -s reload
    ```

2. 网关配置
    ```
    spring.servlet.multipart.max-file-size=50MB
    spring.servlet.multipart.max-request-size=100MB
    ```

3. 文件上传/下载的业务模块配置
    ```
    spring.servlet.multipart.max-file-size=50MB
    spring.servlet.multipart.max-request-size=100MB
    ```

4. 文件确实过大
   - 压缩文件
   - 拆分文件
   - 调整上述配置
