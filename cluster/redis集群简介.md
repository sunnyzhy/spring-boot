# Redis的容错机制
节点之间会定时的互相发送 ping 命令，测试节点的健康状态，当节点接受到 ping 命令后，会返回一个 pong 字符串。

投票机制：如果一个节点 A 给节点 B 发送 ping 没有得到 pong 返回，会通知其他节点再次给 B 发送 ping ，如果集群中有超过一半的节点收不 B 节点的 pong。那么就认为 B 节点挂了。一般会为每个节点提供一个备份节点，如果挂掉会切换到备份节点。

# Redis集群存储原理
Redis 对于每个存放的 key 会进行 hash 操作，生成一个 [0 - 16384] 的 hash 值（先进行 crc 算法再对 16384 取余）。

集群的情况下，就是把 [0 - 16384] 的区间进行拆分，放到不同的 redis 中。每个 Redis 集群理论上最多可以有 16384 个节点。

# Redis的持久化
Snapshotting：定时的将 Redis 内存中的数据保存到硬盘中。

AOF：将所有的 command 操作保存到 aof 中，AOP 的同步频率很高，数据即使丢失，粒度也很小，但会在性能上造成影响。

# Redis集群搭建所需要的环境
1. **Redis 集群至少需要 3 个节点**，因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以 2 个节点无法构成集群。

2. **要保证集群的高可用，需要每个节点都有从节点，也就是备份节点，所以 Redis 集群至少需要 6 台服务器。**

3. 安装ruby
